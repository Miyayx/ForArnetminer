var originalData = 
[{"keyword":104763,
	"name":"Jim Gray",
	"details":"Jim Gray\nH-index:32\n#Pubs:115",
	"type":0,
	"weight":32,
	"imgurl":"http://pic1.aminer.org/picture/486/1225200472398.gif",
	"links":[[412623,100,0],[666,100,0]]},
{"keyword":412623,
	"name":"JD Ullman",
	"details":"J. D. Ullman\nH-index:63\n#Pubs:266",
	"type":0,
	"weight":63,
	"imgurl":"http://pic1.aminer.org/picture/486/1225200371974.gif",
	"links":[[113059,100,0],[1155180,100,0],[104763,100,0],[963489,100,0],[2028,100,0]]},
{"keyword":196045,
	"name":"AB Borodin",
	"details":"Allan B. Borodin\nH-index:13\n#Pubs:107",
	"type":0,
	"weight":13,
	"imgurl":"http://pic2.aminer.org/picture/487/1225200737891.gif",
	"links":[[666565,100,0],[963489,100,0]]},
{"keyword":666565,
	"name":"A Razborov",
	"details":"A. Razborov\nH-index:28\n#Pubs:83",
	"type":0,
	"weight":28,
	"imgurl":"http://www.cs.uchicago.edu/files/photos/razborov.jpg",
	"links":[[1120181,100,0],[190,100,0],[196045,100,0]]
},{"keyword":1234490,
	"name":"JY Cai",
	"details":"Jin Yi Cai\nH-index:28\n#Pubs:190",
	"type":0,
	"weight":28,
	"imgurl":"http://pic2.aminer.org/picture/40/1225198884761.jpeg",
	"links":[[1120181,100,0],[324196,100,0]]
},{"keyword":902365,
	"name":"FRK Chung",
	"details":"Fan R. K. Chung\nH-index:28\n#Pubs:125",
	"type":0,
	"weight":28,
	"imgurl":"http://www.math.ucsd.edu/~fan/photo/fan_v3s.jpg",
	"links":[[1202,100,0],[1120181,100,0],[965,100,0]]
},{"keyword":1632,
	"name":"P Koiran",
	"details":"P. Koiran\nH-index:4\n#Pubs:94",
	"type":0,
	"weight":4,
	"imgurl":"http://pic2.aminer.org/picture/488/1225201272351.jpeg",
	"links":[[113059,100,0],[837989,100,0]]
},{"keyword":32338,
	"name":"SH Whitesides",
	"details":"S. H. Whitesides\nH-index:14\n#Pubs:127",
	"type":0,
	"weight":14,
	"imgurl":"http://pic0.aminer.org/picture/487/1225200732764.jpeg",
	"links":[[963489,100,0],[1828,100,0]]
},{"keyword":1385279,
	"name":"BM Maggs",
	"details":"Bruce M. Maggs\nH-index:23\n#Pubs:89",
	"type":0,
	"weight":23,
	"imgurl":"http://pic0.aminer.org/picture/487/1225200773794.gif",
	"links":[[74831,100,0],[1202,100,0]]
},{"keyword":113059,
	"name":"C Papadimitriou",
	"details":"C. Papadimitriou\nH-index:45\n#Pubs:356",
	"type":0,
	"weight":45,
	"imgurl":"http://pic2.aminer.org/picture/486/1225200366064.jpeg",
	"links":[[412623,100,0],[1632,100,0]]},
{"keyword":74831,
	"name":"R Tarjan",
	"details":"R. Tarjan\nH-index:32\n#Pubs:264",
	"type":0,
	"weight":32,
	"imgurl":"http://www.cs.princeton.edu/~ret/RET.gif",
	"links":[[285297,100,0],[963489,100,0],[1385279,100,0]]},
{"keyword":1339007,
	"name":"JL Bentley",
	"details":"Jon L. Bentley\nH-index:22\n#Pubs:95",
	"type":0,
	"weight":22,
	"imgurl":"http://www.squeezechart.com/image153.jpeg",
	"links":[[1120181,100,0],[666,100,0]]},
{"keyword":605713,
	"name":"L Guibas",
	"details":"Leonidas Guibas\nH-index:61\n#Pubs:357",
	"type":0,
	"weight":61,
	"imgurl":"http://pic1.aminer.org/picture/486/1225200374716.jpeg",
	"links":[[1120181,100,0],[1828,100,0]]},
{"keyword":1828,
	"name":"CK Yap",
	"details":"Chee K. Yap\nH-index:32\n#Pubs:133",
	"type":0,
	"weight":32,
	"imgurl":"http://pic0.aminer.org/picture/486/1225200607992.jpeg",
	"links":[[605713,100,0],[32338,100,0]]},
{"keyword":963489,
	"name":"JE Hopcroft",
	"details":"John E. Hopcroft\nH-index:26\n#Pubs:106",
	"type":0,
	"weight":26,
	"imgurl":"http://www.cs.cornell.edu/jeh/images/HopcroftI.jpg",
	"links":[[74831,100,0],[412623,100,0],[402579,100,0],[196045,100,0],[998702,100,0],[397055,100,0],[32338,100,0]]},
{"keyword":2028,
	"name":"H Gupta",
	"details":"Himanshu Gupta\nH-index:17\n#Pubs:67",
	"type":0,
	"weight":17,
	"imgurl":"http://www.wings.cs.sunysb.edu/images/hgupta.jpg",
	"links":[[412623,100,0]]},
{"keyword":150,
	"name":"M Hong",
	"details":"Mingsheng Hong\nH-index:9\n#Pubs:14",
	"type":0,
	"weight":9,
	"imgurl":"http://pic2.aminer.org/picture/40/1225198722017.jpeg",
	"links":[[397055,100,0]]},
{"keyword":91,
	"name":"Yu Yu",
	"details":"Yu Yu\nH-index:3\n#Pubs:15",
	"type":0,
	"weight":3,
	"imgurl":"http://pic.aminer.org/picture/images/no_photo.jpg",
	"links":[[285297,100,0]]},
{"keyword":837989,
	"name":"K Marek",
	"details":"Karpinski Marek\nH-index:34\n#Pubs:278",
	"type":0,
	"weight":34,
	"imgurl":"http://pic0.aminer.org/picture/486/1225200387439.jpeg",
	"links":[[1120181,100,0],[1632,100,0]]},
{"keyword":1155180,
	"name":"R Graham",
	"details":"Ronald Graham\nH-index:24\n#Pubs:120",
	"type":0,
	"weight":24,
	"imgurl":"http://pic.aminer.org/picture/images/no_photo.jpg",
	"links":[[1120181,100,0],[412623,100,0]]},
{"keyword":1120181,
	"name":"A Yao",
	"details":"Andrew Yao\nH-index:36\n#Pubs:149",
	"type":0,
	"weight":36,
	"imgurl":"http://pic1.aminer.org/picture/486/1225200498202.jpeg",
	"links":[[837989,100,0],[20044,100,0],[1155180,100,0],[285297,100,0],[1339007,100,0],[605713,100,0],[666565,100,0],[902365,100,0],[1234490,100,0]]},
{"keyword":285297,
	"name":"M Yung",
	"details":"Moti Yung\nH-index:45\n#Pubs:399",
	"type":0,
	"weight":45,
	"imgurl":"http://pic0.aminer.org/picture/01277/Moti_Yung_1311213212372.png",
	"links":[[74831,100,0],[1120181,100,0],[91,100,0]]},
{"keyword":798,
	"name":"J Browne",
	"details":"J. Browne\nH-index:10\n#Pubs:105",
	"type":0,
	"weight":10,
	"imgurl":"http://pic0.aminer.org/picture/486/1225200573087.gif",
	"links":[[998702,100,0],[324196,100,0]]},
{"keyword":397055,
	"name":"AJ Demers",
	"details":"A. J. Demers\nH-index:26\n#Pubs:84",
	"type":0,
	"weight":26,
	"imgurl":"http://pic1.aminer.org/picture/489/1225201522157.jpeg",
	"links":[[20044,100,0],[963489,100,0],[150,100,0]]},
{"keyword":324196,
	"name":"DF Towsley",
	"details":"D. F. Towsley\nH-index:45\n#Pubs:383",
	"type":0,
	"weight":45,
	"imgurl":"http://pic2.aminer.org/picture/486/1225200369923.jpeg",
	"links":[[1234490,100,0],[798,100,0]]},
{"keyword":20044,
	"name":"FF Yao",
	"details":"F. F. Yao\nH-index:8\n#Pubs:61",
	"type":0,
	"weight":8,
	"imgurl":"http://pic0.aminer.org/picture/490/1225202344302.jpeg",
	"links":[[1120181,100,0],[397055,100,0]]},
{"keyword":1202,
	"name":"E Schwabe",
	"details":"E. Schwabe\nH-index:6\n#Pubs:31",
	"type":0,
	"weight":6,
	"imgurl":"http://pic1.aminer.org/picture/493/1225203675597.gif",
	"links":[[902365,100,0],[1385279,100,0]]},
{"keyword":190,
	"name":"S Artëmov",
	"details":"Sergei Artëmov\nH-index:3\n#Pubs:15",
	"type":0,
	"weight":3,
	"imgurl":"http://pic.aminer.org/picture/images/no_photo.jpg",
	"links":[[666565,100,0]]},
{"keyword":666,
	"name":"M Schkolnick",
	"details":"M. Schkolnick\nH-index:3\n#Pubs:30",
	"type":0,
	"weight":3,
	"imgurl":"http://pic.aminer.org/picture/images/no_photo.jpg",
	"links":[[104763,100,0],[1339007,100,0]]},
{"keyword":402579,
	"name":"RM Karp",
	"details":"Richard M. Karp\nH-index:50\n#Pubs:207",
	"type":0,
	"weight":50,
	"imgurl":"http://pic2.aminer.org/picture/486/1225200415608.jpeg",
	"links":[[963489,100,0],[965,100,0]]},
{"keyword":998702,
	"name":"C Bajaj",
	"details":"Chandrajit Bajaj\nH-index:34\n#Pubs:164",
	"type":0,
	"weight":34,
	"imgurl":"http://pic0.aminer.org/picture/486/1225200528744.jpeg",
	"links":[[963489,100,0],[798,100,0]]},
{"keyword":965,
	"name":"P. Dagum",
	"details":"P. Dagum\nH-index:0\n#Pubs:14",
	"type":0,    
	"weight":0,
	"imgurl":"http://pic.aminer.org/picture/images/no_photo.jpg",
	"links":[[402579,100,0],[902365,100,0]]}]

	var allPaths = new Array();

	function changeJson(){
		//var original = new Array(32); 
		//	var queried = [963489,1120181,397055,74831,412623,666565]; 
		var queried = [963489,1120181,397055,74831,412623]; 
		//	var queried = [963489,1120181,397055,74831]; 
		//	var queried = [963489,1120181,397055]; 
		//	var queried = [963489,1120181]; 
		//	var queried = [1120181]; 
		var original = originalData;
		var site = {};
		site.nodes = {};
		site.edges = {};

		var mainPositions = coordinate(queried.length,{x:0,y:0},2.5);
		var mainNodes = new Array();

		for(var i = 0;i < original.length;i++)
		{
			var current = original[i];
			site.nodes[current.keyword] = {};
			if(queried.contains(original[i].keyword)){
				site.nodes[current.keyword].main = true;
				site.nodes[current.keyword].xx = mainPositions[mainNodes.length].x;
				site.nodes[current.keyword].yy = mainPositions[mainNodes.length].y;
				mainNodes.push(current);
			}

			site.nodes[current.keyword].type = "image";
			site.nodes[current.keyword].alpha = 1;
			site.nodes[current.keyword].img = {};
			if(current.imgurl.length == 0)
				site.nodes[current.keyword].img = null;
			else{
				site.nodes[current.keyword].img.url = current.imgurl
					//var urls = current.imgurl.split('.');
					//site.nodes[current.keyword].img.url ="./pic/"+ current.keyword+'.'+urls[urls.length-1];
					site.nodes[current.keyword].img.size = getSizeFromWeight(current.weight);
			}
			site.nodes[current.keyword].weight = current.weight;
			site.nodes[current.keyword].name = current.name;
			site.nodes[current.keyword].details = current.details;

			site.nodes[current.keyword].paths = new Array();
			site.edges[current.keyword] = {};
			for(var j = 0;j < current.links.length;j++){
				site.edges[current.keyword][current.links[j][0]] = {};
				site.edges[current.keyword][current.links[j][0]].length = 0.8;
				site.edges[current.keyword][current.links[j][0]].width = 2;
				if(Math.random() > 0.7){
					//site.edges[current.keyword][current.links[j][0]].directed = true;
				}
				//for(var k = 0;k < details.leeh;k++){
				//	site.nodes[details[k]]={};
				//	site.nodes[details[k]].type = "detail";
				//	site.nodes[details[k]].alpha = 0;
				//site.nodes[details[k]].color = "#23a4ff";
				//				site.edges[current.keyword][details[k]]={};
				//
				//				}
			}

		}
		for(var m=0;m<mainNodes.length;m++){
			for(var n=m+1;n<mainNodes.length;n++){
				findPathsBetweenTwoNodes(site,new Array(),mainNodes[m],mainNodes[n]);
			}
		}

		return eval("("+JSON.stringify(site)+")");
	}


Array.prototype.contains = function (element) {    
	for (var i = 0; i < this.length; i++) {    
		if (this[i] == element) {    
			return true;    
		}    
	}    
	return false;    
} 


function coordinate(num,center,r){

	var points = new Array();
	var degree = 180/num;
	if(num < 2){
		points.push(center);
		return points;
	}
	if(num == 2){
		points.push({x:center.x-r,y:center.y});
		points.push({x:center.x+r,y:center.y});
		return points;
	}
	for(var i=0;i<num;i++){
		var currentP = {};
		currentP.x = center.x+r*Math.sin(i/num*2*Math.PI);
		currentP.y = center.y+r*Math.cos(i/num*2*Math.PI);
		points.push(currentP);
	}
	return points;
}

function getSizeFromWeight(weight){
	var minSize = 50;
	var maxSize = 75;

	return minSize+(maxSize-minSize)*(weight/(100-0));
}


function findPathsBetweenTwoNodes(site,cPathStack,startNode,endNode){
	if(startNode ==null || endNode == null)return;
	if(startNode != endNode){
		cPathStack.push(startNode.keyword);
		for(var i=0;i<startNode.links.length;i++){
			var nextKey = startNode.links[i][0];
			if(cPathStack.contains(nextKey))
				continue;
			if(nextKey!= endNode.keyword&&site.nodes[nextKey].main) continue;
			else{
				findPathsBetweenTwoNodes(site,cPathStack,getNode(startNode.links[i][0]),endNode);
			}
		}
		cPathStack.pop();
	}else{
		cPathStack.push(startNode.keyword);
		allPaths[allPaths.length]=cPathStack.slice();
		cPathStack.pop();
		for(var i=0;i< cPathStack.length;i++){
			site.nodes[cPathStack[i]].paths.push(allPaths.length);
		}
	}

}
function getNode(keyword){
	for(var i = 0;i < originalData.length;i++)
	{
		if(originalData[i].keyword==keyword)
			return originalData[i]
	}
}

function getAllPaths(){
	return allPaths;
}
